\documentclass[a4paper,11pt,dvipsnames]{article}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{titling}  %allows for title and abstract to be together. There are also packages: title and abstract.
\usepackage[margin = 1in]{geometry}
\usepackage{xcolor}

\title{\textbf{Phase Field Solver for Recrystallization}}
\author{Vitesh Shah}

\begin{document}
\nonstopmode
\begin{titlingpage}
	\maketitle
	\begin{abstract}
	This document details the solving strategy for phase field solvers being used for recrystallization. 
    The methods described here are borrowed from work of Shantharaj et al. \cite{Shanthraj2019}. 
    Most of the code related to this work can be found on the branch `\verb|RX_Phase_Field|' of GIT repository 
    \url{https://magit1.mpie.de/damask/DAMASK/-/tree/RX_Phase_Field}. 
    The codes being referred to are \verb|grid_orientation_spectral.f90| and 
    \verb|grid_thermal_spectral.f90|
	\end{abstract}
\end{titlingpage}

%======================================================================================================================================================================================
%-------------Describing new commands for some special mathematical characters---------------------------------------------------------------------------------------------------------
\newcommand\mathsym[1]{\begin{math} {#1} \end{math}}
\newcommand{\Tau}{\mathrm{T}}
%====================================================================================================================================================================================

\section{Orientation field solver}
The equation for the orientation field can be described as equation 40 in \cite{Abrivard2012b},

\begin{equation}
    \tau_\theta \frac{\partial \theta}{\partial t} = \nabla \cdot \left ( 2h(\eta) \nabla \theta + g(\eta) \frac{\nabla \theta}{\left | \nabla \theta \right |} \right ) \label{eq:1} 
\end{equation}

% For initial attempt, we simplify the equation above,
% \begin{equation}
    % \tau_\theta \frac{\partial \theta}{\partial t} = \nabla \cdot \left ( 2h(\eta) \nabla \theta \right ) \label{eq:2} 
% \end{equation}

The equation above is quite similar to the equation of non-steady heat conduction \cite{Shanthraj2019}. 
The only difference is that there is no source term here. 
The orientation \mathsym{\theta} is of type quaternion and 
using backward euler and splitting into fluctuations, the above equation can be written as, 

\begin{equation}
\left ( \overline{\tau}_\theta + \tilde{\tau}_\theta \right ) \frac{\theta (x,t) - \theta (x,t_o)}{\Delta t} = 
\nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) + \tilde{T}_1 (x) + 
\frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \nabla \theta (x,t) + \tilde{T}_2 (x)\right ] \label{eq:3}
\end{equation}

where \mathsym{2h(\eta) \nabla \theta = 2 \overline{h} (\eta) \nabla \theta + \tilde{T}_1 (x)} and 
\mathsym{\frac{g(\eta)}{\left | \nabla \theta \right |} \nabla \theta = 
\frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \nabla \theta + \tilde{T}_2 (x)}. 
Notice the term \mathsym{\frac{\overline{g}(\eta)}{\left | \nabla \theta \right |}}. 
Here, as norm of a gradient is a scalar quantity, \mathsym{\left | \nabla \theta \right |} is 
considered together with \mathsym{\overline{g}(\eta)}. 
This results in the third term on the right hand side to be of the same type as the first term on the right hand side. 
The equation above can be re-written in the Fourier space as,

\begin{equation}
\left ( \overline{\tau}_\theta + \tilde{\tau}_\theta \right ) \frac{\theta (k,t) - \theta (k,t_o)}{\Delta t} = 
\mathcal{F} \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) + \tilde{T}_1 (x) + 
\frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \nabla \theta (x,t) + \tilde{T}_2 (x)\right ] \label{eq:4}
\end{equation}

Expressing the terms in real space in Fourier space, with example shown for the case of the first term on right hand side of 
equation \ref{eq:4}, 

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \right ] \left ( \nabla \mathcal{F}^{-1} \left (\theta (k,t) \right ) \right ) \right ] \label{eq:5}
\end{equation}

where \mathsym{\theta (x,t) = \mathcal{F}^{-1} \left (\theta (k,t) \right )}. 
Using definition of inverse fourier transform, 

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \right ] \left ( \nabla \int \theta (k,t) e^{ikx} dk \right ) \right ] \label{eq:6}
\end{equation}

The gradient operator leads to following integral, 

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \right ] \left ( \int ik \theta (k,t) e^{ikx} dk \right ) \right ] \label{eq:7}
\end{equation}

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\mathcal{F} \left [ \nabla \cdot \left ( \int 2 \overline{h} (\eta) \cdot ik \cdot \theta (k,t) e^{ikx} dk \right ) \right ] \label{eq:8}
\end{equation}

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\mathcal{F} \left [ \int 2 \overline{h} (\eta) \cdot ik \cdot \theta (k,t) \cdot ik \cdot e^{ikx} dk \right ] \label{eq:9}
\end{equation}

Again invoking the definition of inverse fourier transform,

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\mathcal{F} \left [ \mathcal{F}^{-1} \left ( 2 \overline{h} (\eta) \cdot ik \cdot \theta (k,t) \cdot ik \right ) \right ] \label{eq:10}
\end{equation}

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \left [ 2 \overline{h}(\eta) \nabla \theta (x,t) \right ] \right ] = 
\left ( 2 \overline{h} (\eta) \cdot ik \cdot \theta (k,t) \cdot ik \right ) \label{eq:11}
\end{equation}

Similarly, the second term in right hand side of equation \ref{eq:4} can be expressed as, 

\begin{equation}
\mathcal{F} \left [ \nabla \cdot \tilde{T}(x) \right ] = 
\tilde{T}(k) \cdot ik \label{eq:12}
\end{equation}

Therefore, the equation \ref{eq:4} can be written in Fourier space as, 

\begin{multline}
\left ( \overline{\tau}_\theta + \tilde{\tau}_\theta \right ) \frac{\theta (k,t) - \theta (k,t_o)}{\Delta t} = 
\left ( 2 \overline{h} (\eta) \cdot ik \cdot \theta (k,t) \cdot ik \right ) +  \tilde{T}_1 (k) \cdot ik \\ 
+ \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot ik \cdot \theta (k,t) \cdot ik + 
\tilde{T}_2 (k) \cdot ik \label{eq:13}
\end{multline}

\begin{multline}
\left ( \overline{\tau}_\theta + \tilde{\tau}_\theta \right ) \left ( \theta (k,t) - \theta (k,t_o) \right ) = 
\Delta t \biggl ( 2 \overline{h} (\eta) \cdot ik \cdot \theta (k,t) \cdot ik +  \tilde{T}_1 (k) \cdot ik \\ 
+ \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot ik \cdot \theta (k,t) \cdot ik + 
\tilde{T}_2 (k) \cdot ik \biggr ) \label{eq:14}
\end{multline}

Re-arranging the terms leads to, 
\begin{multline}
\biggl ( \overline{\tau}_\theta + \Delta t \cdot k \cdot 2 \overline{h} (\eta) \cdot k 
+ k \cdot \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot k \biggr ) \theta (k,t) = 
\Delta t \tilde{T}_1 (k) \cdot ik + \Delta t \tilde{T}_2 (k) \cdot ik + \\
\overline{\tau}_\theta \theta (k,t_o) - \tilde{\tau}_\theta \theta (k,t) + \tilde{\tau}_\theta \theta (k,t_o) \label{eq:15}
\end{multline}

It can be assumed that \mathsym{\tilde{T}_1 (k) + \tilde{T}_2 (k) \approx \tilde{T} (k)}, 
where, 
\mathsym{\tilde{T}(k) \approx 2 h (\eta) \nabla \theta - 2 \overline{h}(\eta) \nabla \theta 
+ \frac{g(\eta)}{\left | \nabla \theta \right |} - \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |}}. 
This can be further written as, \mathsym{\tilde{T}(k) \approx \left ( 2 h (\eta) + \frac{g(\eta)}{\left | \nabla \theta \right |} 
- D_\text{ref} \right ) \nabla \theta}. 
\mathsym{D_{\text{ref}}} is assumed to be the constant 
\mathsym{2 \overline{h} (\eta) + \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |}} calculated at the very initial time step. 
Using the definition of \mathsym{\tau_\theta = \overline{\tau}_\theta + \tilde{\tau}_\theta}, the equation becomes, 

\begin{multline}
\biggl ( \overline{\tau}_\theta + \Delta t \cdot k \cdot 2 \overline{h} (\eta) \cdot k 
+ k \cdot \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot k \biggr ) \theta (k,t) = 
\Delta t \tilde{T}(k) \cdot ik + \tau_\theta \theta (k,t_o) - \tilde{\tau}_\theta \theta (k,t) \label{eq:16}
\end{multline}

\begin{equation}
\biggl ( \overline{\tau}_\theta + \Delta t \cdot k \cdot 2 \overline{h} (\eta) \cdot k 
+ k \cdot \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot k \biggr ) \theta (k,t) = 
\Delta t \tilde{T}(k) \cdot ik + \tau_\theta \theta (k,t_o) - 
\left [ \tau_\theta - \overline{\tau}_\theta \right ] \theta (k,t) \label{eq:17}
\end{equation}

\begin{equation}
\biggl ( \overline{\tau}_\theta + \Delta t \cdot k \cdot 2 \overline{h} (\eta) \cdot k 
+ k \cdot \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot k \biggr ) \theta (k,t) = 
\Delta t \tilde{T}(k) \cdot ik + \tau_\theta \theta (k,t_o) - 
\left [ \tau_\theta - \overline{\tau}_\theta \right ] \theta (k,t) \label{eq:18}
\end{equation}

The right hand side equation is quite similar to the one mentioned in the \verb|formResidual| function of thermal fields. 
But, the orientation field solver has some extra term related to oriSource, which are not visible in the derivation here. 
The term \mathsym{\overline{\tau}_\theta (k,t)} is defined as mobility\textunderscore ref in the code following convention used 
for thermal fields. 
The term on the left hand side can be defined as the gamma convolution, 

\begin{equation}
    \Gamma^{-1} = \overline{\tau}_\theta + \Delta t \cdot k \cdot 2 \overline{h} (\eta) \cdot k 
    + k \cdot \frac{\overline{g}(\eta)}{\left | \nabla \theta \right |} \cdot k \label{eq:19}
\end{equation}

This leads to following residual, 

\begin{equation}
    \theta (k,t) - \Gamma (k) T(k) = 0 \label{eq:20}
\end{equation}

where T(k) is the entire expression on the right hand side of equation \ref{eq:15}. 


\bibliographystyle{ieeetran}
%can use bibliographystyle{plain} for the most basic things but it doesnt order the citations properly
\bibliography{library}
\end{document}

